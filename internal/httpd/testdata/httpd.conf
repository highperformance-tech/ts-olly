################################################################
# httpd.conf is generated automatically from httpd.conf.ftl
# Changes made directly in httpd.conf will be lost. DO NOT EDIT.
################################################################
# Apache httpd official documentation:
#     http://httpd.apache.org/docs/2.4/
#     http://httpd.apache.org/docs/2.4/mod/directives.html

# Gateway_config_os == linux, TSIG expansion mode == false
    ServerRoot "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/apache"

LoadModule alias_module modules/mod_alias.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule dir_module modules/mod_dir.so
LoadModule expires_module modules/mod_expires.so
LoadModule filter_module modules/mod_filter.so
LoadModule headers_module modules/mod_headers.so
LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so
LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule mime_module modules/mod_mime.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_http_module modules/mod_proxy_http.so
    LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
        LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
LoadModule unique_id_module modules/mod_unique_id.so
    LoadModule unixd_module modules/mod_unixd.so
LoadModule log_rotate_module modules/mod_log_rotate.so
LoadModule security2_module modules/mod_security2.so
    LoadModule xsendfile_module modules/mod_xsendfile.so
LoadModule ssl_module modules/mod_ssl.so
# LogLevel: see https://httpd.apache.org/docs/2.4/mod/core.html#loglevel
# Here's an example if you want logging of rewrites, but everything else to stay at "notice".
# This kind of logging gets written to error.log.
# tsm configuration set -k gateway.httpd.loglevel -v "notice rewrite:trace3"
# Caution: Some modules can produce A LOT!!! of output, and it can also have a performance hit.
# Set this back to the default after you've done your troubleshooting or experimenting.
LogLevel notice

DefaultRuntimeDir "/var/opt/tableau/tableau_server/data/tabsvc/httpd/temp"
PidFile "/var/opt/tableau/tableau_server/data/tabsvc/httpd/httpd.pid"


# explicitly set that child processes will never terminate to recycle, 0 is the default but be explicit anyway
MaxConnectionsPerChild 0
EnableSendfile Off

        ServerLimit       18
        MaxRequestWorkers 576
        MaxSpareThreads   288
        ThreadsPerChild   64
        ThreadLimit       64

KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 8
AddDefaultCharset utf-8
ServerAdmin admin@example.com
    XSendFile on
    XSendFileDeleteOnClose on
    XSendFilePath "/var/opt/tableau/tableau_server/data/tabsvc/temp"
RewriteEngine on

################################################################
# Pro-actively remove any headers that we might be adding later.
# It's usually OK to remove them unconditionally even if we don't know
# at this point if we'll be adding them later. NB: "early"
################################################################
RequestHeader unset SERVER_HOST                  early
RequestHeader unset X-Tsi-Request-Uri            early
# TFSID: 667105
RequestHeader unset X-Client-Certificate         early
# TFSID: 667105
RequestHeader unset X-Client-Subject-CN          early
# Unset the X-Remote-User header to prevent sso impersonation through the manual prefix
RequestHeader unset X-Remote-User                early
# X-Request-Id is only used for tracing through logs, so it's not security sensitive. And append is used instead of set.
#RequestHeader unset X-Request-Id                 early
## BUGZID: 25148 need to strip this out to stop rails from falsely declaring a spoofing attack.
RequestHeader unset Client-IP                    early
## BUGZID: 28302 Prevent false spoofing error with an underscore in the header name as well
RequestHeader unset Client_IP                    early
RequestHeader unset X-Request-Port               early
RequestHeader unset X-Forwarded-Site             early
RequestHeader unset REQUEST_SECRET               early
# TFSID: 542277 Drop all upstream Proxy headers to mitigate the "httpoxy" vulnerability.
RequestHeader unset Proxy                        early
## RequestHeader unset X_FORWARDED_PROTO            early
## RequestHeader unset X-FORWARDED-PROTO            early
RequestHeader unset X-Request-Port               early
################################################################

  # glhn cluster001-0
  ServerName cluster001-0:8080
UseCanonicalName off
    Listen 8080


Header set X-Tableau "Tableau Server"
Header append P3P 'CP="NON"'

<Directory />
    Options FollowSymLinks
    AllowOverride None
    Require all denied
</Directory>

DocumentRoot "/var/opt/tableau/tableau_server/data/tabsvc/httpd/htdocs"
<Directory "/var/opt/tableau/tableau_server/data/tabsvc/httpd/htdocs">
    AllowOverride None
    Require all granted
</Directory>

<DirectoryMatch "^/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizqlserver/public(/v_[^/]+)?">
    Require all granted
</DirectoryMatch>

<FilesMatch "favicon.ico">
    Require all granted
    ExpiresDefault "access plus 3 days"
</FilesMatch>
Alias /favicon.ico "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/public/favicon.ico"
ProxyPassMatch /favicon.ico$ !

<FilesMatch "apple-touch-icon-precomposed.png">
    Require all granted
</FilesMatch>
Alias /apple-touch-icon-precomposed.png "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/public/apple-touch-icon-precomposed.png"
ProxyPassMatch /apple-touch-icon-precomposed.png$ !

<FilesMatch "apple-touch-icon-[0-9]*x[0-9]*.png">
    Require all granted
</FilesMatch>
AliasMatch /(apple-touch-icon-[0-9]*x[0-9]*.png) "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/public/$1"
ProxyPassMatch /apple-touch-icon-[0-9]*x[0-9]*.png$ !

<Files ".ht*">
    Require all denied
</Files>

    RewriteCond %{QUERY_STRING} "(.*)refresh-token=(.*)" [NC]
    RewriteRule ^ - [E=dont_log_query_string:true]

    RewriteCond %{QUERY_STRING} "(.*)access-token=(.*)" [NC]
    RewriteRule ^ - [E=dont_log_query_string:true]
    Define ANNOTATED_HTTP_CODES "200,400,401,403,404,406,408,409,410,412,413,414,416,418,423,429,431,499,500,501,503,504"
    Define TAB_ERR_ANNOTATIONS "\
%${ANNOTATED_HTTP_CODES}{tableau_error_source}o \
%${ANNOTATED_HTTP_CODES}{tableau_status_code}o \
%${ANNOTATED_HTTP_CODES}{tableau_error_code}o \
%${ANNOTATED_HTTP_CODES}{tableau_service_name}o"

        # formatted according to TFS 706852
        LogFormat "%V %h %u %{%Y-%m-%dT%X}t.%{msec_frac}t \"%{%z}t\" %p \"%r\" \"%{X-Forwarded-For}i\" %>s %b \"%{Content-Length}i\" %D %{UNIQUE_ID}e ${TAB_ERR_ANNOTATIONS} \"%{X-Tableau-Trace-Id}i\"" common

        # TFSID:997058
        LogFormat "%V %h %u %{%Y-%m-%dT%X}t.%{msec_frac}t \"%{%z}t\" %p \"%m %U %H\" \"%{X-Forwarded-For}i\" %>s %b \"%{Content-Length}i\" %D %{UNIQUE_ID}e ${TAB_ERR_ANNOTATIONS} \"%{X-Tableau-Trace-Id}i\"" common_no_query_string

    RotateLogs On
    RotateLogsLocalTime On
    RotateInterval 86400
        CustomLog "/var/opt/tableau/tableau_server/data/tabsvc/logs/httpd/access.%Y_%m_%d_%H_%M_%S.log" common env=!dont_log_query_string
        # TFSID:997058
        CustomLog "/var/opt/tableau/tableau_server/data/tabsvc/logs/httpd/access.%Y_%m_%d_%H_%M_%S.log" common_no_query_string env=dont_log_query_string
ErrorLog "/var/opt/tableau/tableau_server/data/tabsvc/logs/httpd/error.log"

        TypesConfig conf/mime.types
    AddType application/x-gzip .tgz
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType application/x-brotli .br
    AddType application/javascript .js
    AddType application/wasm .wasm

TimeOut 7200

ErrorDocument 403 /vizportalclient/pageNotFound.var
ErrorDocument 404 /vizportalclient/pageNotFound.var

<Location /vizql>
ErrorDocument 500 /errors/5xx_subpage.html
ErrorDocument 502 /errors/5xx_subpage.html
ErrorDocument 503 /errors/5xx_subpage.html
</Location>

RewriteCond %{HTTP_COOKIE} workgroup_session_id=([^|;]+)
RewriteRule .* - [E=workgroup_session_id_for_logging:%1]

# short-circuit re-write subquery if we're just do a lockahead
# to map virtual path to the filesystem for static gzip file support
RewriteCond %{ENV:GZIP_LOOKAHEAD} !=""
RewriteRule "^(.*)(\.js|\.css|\.html|\.map|\.svg|\.wasm)" - [L]
RewriteRule .* - [E=SERVER_HOST:%{SERVER_NAME},NE]
RequestHeader set SERVER_HOST "%{SERVER_HOST}e"
RewriteRule .* - [E=INFO_REQUEST_URI:%{REQUEST_URI}?%{QUERY_STRING},NE]
RequestHeader set X-Tsi-Request-Uri "%{INFO_REQUEST_URI}e"

RewriteCond %{HTTPS} off
RewriteRule .* - [E=scheme:http]
RewriteCond %{HTTPS} on
RewriteRule .* - [E=scheme:https]
RewriteCond %{HTTP:X-Forwarded-Proto} http
RewriteRule .* - [E=scheme:http]
RewriteCond %{HTTP:X-Forwarded-Proto} https
RewriteRule .* - [E=scheme:https]

<If "%{QUERY_STRING} !~ /redirect_uri=http/">
    Header edit Location ^http[s]?: %{scheme}e:
</If>

SetEnvIf Host ":[0-9]+$" port_part_from_request=$0

# TFSID: 1163561 get rid of query part of the Referer header since it might contain sensitive stuff that we don't want to log
SetEnvIf Referer "^[^?]*" referer_stub=$0

RewriteRule ^/(t/([^/]*)/)?manual/(.*) /$1$3 [NE,E=DROPPED_MANUAL_PREFIX]

RewriteCond %{QUERY_STRING} (.*format=xml.*)
RewriteRule ^/(t/([^/]*)/)?auth/?$ /$1vizportal/api/clientxml/auth [QSA]

RewriteRule ^/(t/([^/]*)/)?auth/logout/?$ /$1vizportal/api/clientxml/auth/logout [QSA]

RequestHeader append X-Request-Id %{UNIQUE_ID}e
# To put the entire httpd server into "maintenance mode" (nothing passes through),
# create an HTML file with a message of your choosing in this location.
# All requests will receive that page's contents as the response.
RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
RewriteCond %{SCRIPT_FILENAME} !maintenance.html
RewriteRule ^.*$ /system/maintenance.html [L]

FileETag MTime Size

Header merge X-UA-Compatible "IE=Edge"

ExpiresActive On
#ExpiresDefault "modification plus 10 years"

AllowEncodedSlashes NoDecode

<VirtualHost *:8080>
    RewriteEngine on
    RewriteOptions Inherit
    RequestHeader set X-Request-Port 8080
    AllowEncodedSlashes NoDecode
    LimitRequestFieldSize 16380
</VirtualHost>


    ProxyPassMatch ^/vizportal_prefix_local/(t/[^/]+/)?(.*) balancer://local-vizportal/$1$2


# This balancer contains one entry for each gateway (or requestrouter) on a host that contains at least one vizportal process.
<Proxy balancer://vizportal-download-cluster>
    BalancerMember http://localhost:8080 retry=300 connectiontimeout=30


    ProxySet lbmethod=byrequests
</Proxy>

<Proxy balancer://local-vizportal>
    BalancerMember http://localhost:8967 retry=300 connectiontimeout=30
    ProxySet lbmethod=byrequests
</Proxy>



<Proxy balancer://datacatalog-cluster>
        BalancerMember http://localhost:8999/relationship-service-war retry=300 connectiontimeout=30
</Proxy>

ProxyPassMatch ^/metadata/graphiql$ !
RedirectMatch ^/metadata/graphiql$ /metadata/graphiql/

#ppd#
  ProxyPassMatch "^/metadata/graphiql/([^/]*)$" balancer://datacatalog-cluster/$1
  ProxyPassReverse /metadata/graphiql/ balancer://datacatalog-cluster/

#ppd#
  ProxyPassMatch "^/relationship-service-war/(graphql)$" balancer://datacatalog-cluster/$1
  ProxyPassReverse /relationship-service-war/graphql balancer://datacatalog-cluster/graphql

#ppd#
  ProxyPassMatch "^/api/exp/metadata/(.*)$" balancer://datacatalog-cluster/$1
  ProxyPassReverse /api/exp/metadata/ balancer://datacatalog-cluster/

#ppd#
  ProxyPassMatch "^/api/metadata/(.*)$" balancer://datacatalog-cluster/$1
  ProxyPassReverse /api/metadata/ balancer://datacatalog-cluster/



#### Flow editor proxy & stickysession config
SetEnvIf REQUEST_URI /site/(.*)/flow-editor/(.*) site_name=$1
RequestHeader set X-Forwarded-Site %{site_name}e env=site_name

# Strip site information.  http://<host>:<port>/site/<site-namespace>/flow-editor/* -> http://<host>:<port>/flow-editor/*
RewriteCond %{REQUEST_URI}  /site/(.*)/flow-editor/(.*)
RewriteRule ^/site/(.*)/flow-editor/(.*)$ /flow-editor/$2 [QSA,NE]


 <Proxy balancer://flow-editor-cluster>
    BalancerMember http://localhost:8803 route=1-0 retry=300 connectiontimeout=30

    ProxySet lbmethod=byrequests


    Header set X-Tableau-Flow-Editor-Instance "%{BALANCER_WORKER_ROUTE}e"
</Proxy>

RewriteCond %{QUERY_STRING} ^(.*&)?__route=[0-9]+-[0-9]+(&.*)?$
RewriteRule (.*/flow-editor.*) /floweditor_instance_balancer$1
#ppd#
  ProxyPass /floweditor_instance_balancer/ balancer://flow-editor-cluster/ stickysession=__route stickysessionsep=Off nofailover=On lbmethod=byrequests
  ProxyPassReverse / balancer://flow-editor-cluster/
<Proxy balancer://flow-editor-gateway-cluster>
    BalancerMember http://localhost:8080 route=1 retry=300 connectiontimeout=30

    ProxySet lbmethod=byrequests
    Header set X-Tableau-Flow-Editor-Route "%{BALANCER_WORKER_ROUTE}e"
</Proxy>

#ppd#
  ProxyPass /flow-editor balancer://flow-editor-gateway-cluster/floweditor_prefix_local/flow-editor stickysession=__route stickysessionsep=Off nofailover=On lbmethod=byrequests
ProxyPassReverse /signin /signin
ProxyPassReverse /flow-editor /flow-editor

<Proxy balancer://local-flow-editor>
    BalancerMember http://localhost:8803 route=1-0 retry=300 connectiontimeout=30

    ProxySet lbmethod=byrequests
    Header set X-Tableau-Flow-Editor-Instance "%{BALANCER_WORKER_ROUTE}e"
</Proxy>

#ppd#
  ProxyPass /floweditor_prefix_local/ balancer://local-flow-editor/

 

 

 

 

<Proxy balancer://local-collections>
    BalancerMember http://localhost:8866/collections/ retry=300 connectiontimeout=30
    ProxySet lbmethod=byrequests
</Proxy>
ProxyPass /collections/favorites !
ProxyPassReverse /collections/favorites !
#ppd#
  ProxyPass /collections/ balancer://local-collections/
  ProxyPassReverse /collections/ balancer://local-collections/
#ppd#
  ProxyPass /api/-/collections balancer://local-collections/collections
  ProxyPassReverse /api/-/collections balancer://local-collections/collections


    <Proxy balancer://local_apigateway>
        ProxySet lbmethod=byrequests
                BalancerMember http://localhost:8812/rest-gateway retry=300 connectiontimeout=30
    </Proxy>

    #pps#
    ProxyPass /api/-/ balancer://local_apigateway/api/-/
    #ppd#
      ProxyPass /services/ balancer://local_apigateway/api/-/
    ProxyPassReverse /api/-/ balancer://local_apigateway/api/-/
    ProxyPassReverse /services/ balancer://local_apigateway/api/-/

<Proxy balancer://local-contentexploration>
    BalancerMember http://localhost:8885/content-exploration/ retry=300 connectiontimeout=30
    ProxySet lbmethod=byrequests
</Proxy>

#ppd#
  ProxyPass /content-exploration/ balancer://local-contentexploration/
  ProxyPassReverse /content-exploration/ balancer://local-contentexploration/
RewriteCond %{REQUEST_METHOD} !GET
RewriteRule ^(.*)/content-exploration/content(.*)$ - [F,L]
RewriteRule ^(.*)/content-exploration/replicas(.*)$ - [F,L]

# Content Metadata Service disabled

<Proxy balancer://local-dataprofiling>
        BalancerMember http://localhost:8995/rls-data-profiling-service retry=300 connectiontimeout=30
    ProxySet lbmethod=byrequests
</Proxy>
#ppd$
  ProxyPass /data-profiling-service/ balancer://local-dataprofiling/
  ProxyPassReverse /data-profiling-service/ balancer://local-dataprofiling/

TraceEnable off

##############################################################################
# Gateway-specific configurations start


<DirectoryMatch "^/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/public(/v_[^/]+)?">
    Require all granted
</DirectoryMatch>

DirectoryIndex index.html

# Instrumentation beacon
# Return a 204 response to requests made to the beacon URL rather than a 404
ProxyPass /inst !
RedirectMatch 204 ^/inst(.*)$

<FilesMatch "viz_v1.js|tableau_v8.js|tableau_v8.debug.js|tableau_v8-vsdoc.js|tableau-2.js|tableau-2.min.js">
    Header set Cache-Control "no-cache, no-store"
</FilesMatch>


SSLRandomSeed startup builtin
SSLRandomSeed connect builtin

ErrorDocument 500 "<html><head><style type='text/css'>html, body, iframe {margin: 0px; padding: 0px; border: none;}</style></head><body><iframe src ='/vizportalclient/internalServerError.var?requestId=%{ENV:UNIQUE_ID}' width='100%' height='100%' frameborder='0' marginheight='0' marginwidth='0' scrolling='auto'/></body></html>"
ErrorDocument 502 "<html><head><style type='text/css'>html, body, iframe {margin: 0px; padding: 0px; border: none;}</style></head><body><iframe src ='/vizportalclient/internalServerError.var?requestId=%{ENV:UNIQUE_ID}' width='100%' height='100%' frameborder='0' marginheight='0' marginwidth='0' scrolling='auto'/></body></html>"
ErrorDocument 503 "<html><head><style type='text/css'>html, body, iframe {margin: 0px; padding: 0px; border: none;}</style></head><body><iframe src ='/vizportalclient/internalServerError.var?requestId=%{ENV:UNIQUE_ID}' width='100%' height='100%' frameborder='0' marginheight='0' marginwidth='0' scrolling='auto'/></body></html>"
# BUGZID: 33517
# Restore error codes for status requests so that AJAX can handle them
<LocationMatch "/admin/status_.*">
ErrorDocument 500 default
ErrorDocument 502 default
ErrorDocument 503 default
</LocationMatch>



<Directory "/var/opt/tableau/tableau_server/data/tabsvc/config/gateway_0.20221.22.0712.0324/httpd" >
    Require all granted
</Directory>

<Directory "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public">
    Require all granted
    ExpiresDefault "access plus 1 year"
    AddHandler type-map .var
    LanguagePriority en
    ForceLanguagePriority Fallback Prefer

    Header set X-Frame-Options "SAMEORIGIN"
</Directory>

Alias /vizportalclient "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public"

# Deflate
AddOutputFilterByType DEFLATE text/html text/plain text/css text/xml application/x-javascript application/javascript application/xml application/json application/xhtml+xml text/javascript image/svg+xml text/css application/wasm application/octet-stream application/x-twb
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4\.0[678] no-gzip
BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

# Uncomment for deflate debugging
#DeflateFilterNote Input input_info
#DeflateFilterNote Output output_info
#DeflateFilterNote Ratio ratio_info
#LogFormat '"%r" %{output_info}n/%{input_info}n (%{ratio_info}n%%)' deflate
#CustomLog logs/myapp_deflate_log.txt deflate

<DirectoryMatch "^/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizqlserver/public(/v_[^/]+)?/(cursors|javascripts|stylesheets|css|html|images|fonts|extensions)">
    Require all granted
    ExpiresDefault "access plus 1 year"
</DirectoryMatch>

<DirectoryMatch "^/var/opt/tableau/tableau_server/data/tabsvc/instance_static_assets/images" >
    Require all granted
    ExpiresDefault "access plus 3 days"
    Header append Cache-Control "must-revalidate"
</DirectoryMatch>

<DirectoryMatch "^/var/opt/tableau/tableau_server/data/tabsvc/httpd(/v_[^/]+)?/images" >
    Require all granted
    ExpiresDefault "access plus 1 year"
</DirectoryMatch>


<DirectoryMatch "^/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/public(/v_[^/]+)?/(images|desktop|javascripts|stylesheets)">
    Require all granted
    ExpiresDefault "access plus 1 year"
</DirectoryMatch>


Alias /errors "/var/opt/tableau/tableau_server/data/tabsvc/config/gateway_0.20221.22.0712.0324/httpd"
ProxyPass /errors !


RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/bootstrapSession/(.*) /vizql/bootstrapSession/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/clear/(.*) /vizql/clear/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/exportcrosstab/(.*) /vizql/exportcrosstab/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/tempfile/(.*) /vizql/tempfile/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/viewData/(.*) /vizql/viewData/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/vudcsv/(.*) /vizql/vudcsv/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/get_customized_views/(.*) /vizql/get_customized_views/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/performPostLoadOperations/(.*) /vizql/performPostLoadOperations/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/getfilteritems/(.*) /vizql/getfilteritems/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/search/(.*) /vizql/search/$4?:site=$2 [QSA,NE]
RewriteRule ^/vizql(/t/([^/]+))?(/w/[^/]+/v/[^/]+)?/searchwithindex/(.*) /vizql/searchwithindex/$4?:site=$2 [QSA,NE]

RewriteRule ^/vizql(/t/[^/]+)?(/w/[^/]+/v/[^/]+)?/(.*) /vizql/$3 [QSA,NE]

RewriteCond %{QUERY_STRING} (.*format=(png|pdf|csv).*)
RewriteRule ^/(t/([^/]*)/)?views/([^/]+)/([^/]+)/([^/]+)(/(.*))? /vizql/get_export?:export_format=%2&:site=$2&:wb=$3&:vw=$4&:cvu=$5&:cvn=$7 [QSA,B,NE]

RewriteRule ^/(t/([^/]*)/)?views/([^/]+)/([^/]+)/([^/]+)(/(.*))?\.(png|pdf|csv) /vizql/get_export?:export_format=$8&:site=$2&:wb=$3&:vw=$4&:cvu=$5&:cvn=$7 [QSA,B,PT,NE]


RewriteCond %{HTTP_USER_AGENT} "(MSIE ([0-9]+)\.|Presto\/)|Trident/.*rv:([0-9]{1,}[\.0-9]{0,})|(iPad|iPhone|iphone|iPod).*?(OS |os |OS_)([0-8]_)"
RewriteCond %{QUERY_STRING} "(.*(?::|%3A)embed=(y|yes|t|true|1).*)" [NC]
RewriteRule ^/(t/([^/]*)/)?views/(.*) /vizportalclient/unsupportedBrowser.var [PT,NE]
RewriteCond %{QUERY_STRING} "(.*(?::|%3A)embed=(y|yes|t|true|1).*)" [NC]
RewriteRule ^/(t/([^/]*)/)?views/([^/]+)/([^/]+)/([^/]+)(/(.*))? /vizql/show_customized?:site=$2&:wb=$3&:vw=$4&:cvu=$5&:cvn=$7 [QSA,B,PT,NE]

RewriteRule ^/(t/([^/]*)/)?authoring/([^/]+)/([^/]+)(/(.*))? /vizql/showAuthoring?:site=$2&:wb=$3&:vw=$4&:authSheet=$6 [QSA,B,PT,NE]

RewriteRule ^/(t/([^/]*)/)?authoringExtractDraft/([^/]+)/([^/]+)/([^/]+)(/(.*))? /vizql/showAuthoring?:site=$2&:wb=$3&:vw=$4&:extractDraftId=$5&:authSheet=$6 [QSA,B,PT,NE]

RewriteRule ^/(t/([^/]*)/)?authoringNewWorkbook/([^/]+)/([^/]+)/? /vizql/showNewWorkbookFromDatasource?:site=$2&:aux=$3&:ds=$4 [PT,B,QSA]

RewriteRule ^/(t/([^/]*)/)?editDatasource/([^/]+)/([^/]+)/? /vizql/showScratchpad?:site=$2&:aux=$3&:ds=$4 [PT,B,QSA]

RewriteRule ^/(t/([^/]*)/)?createPublishedDatasource/(p/([0-9]*)/)?([^/]+)/? /vizql/showScratchpadNoDatasource?:site=$2&:project=$4&:aux=$5 [PT,B,QSA]

RewriteCond %{THE_REQUEST} /(t/([^/]*)/)?askData/lens/([^/\ \?]+)
RewriteRule ^/(t/([^/]*)/)?askData/lens/([^/]+) /vizql/showNewNlpLensWorkbookWithExplorationLayout?:site=$2&:repoUrl=%3 [PT,B,QSA,NE]

RewriteCond %{THE_REQUEST} /(t/([^/]*)/)?startAskData/lens/([^/\ \?]+)
RewriteRule ^/(t/([^/]*)/)?startAskData/lens/([^/]+) /vizql/showNewNlpLensWorkbookWithLandingLayout?:site=$2&:repoUrl=%3 [PT,B,QSA,NE]
RewriteRule ^/(t/([^/]*)/)?askData/([^/]+)/? /vizql/showNewNlpWorkbookWithExplorationLayout?:site=$2&:repoUrl=$3 [PT,B,QSA]
RewriteRule ^/(t/([^/]*)/)?startAskData/([^/]+)/? /vizql/showNewNlpWorkbookWithLandingLayout?:site=$2&:repoUrl=$3 [PT,B,QSA]

RewriteRule ^/(t/([^/]*)/)?newWorkbook/(p/([0-9]*)/)?([^/]+)/? /vizql/showNewWorkbook?:site=$2&:project=$4&:aux=$5 [PT,B,QSA]
RewriteCond %{QUERY_STRING} (.*format=(png|pdf|csv).*)
RewriteRule ^/(t/([^/]*)/)?views/([^/]+)/(.*) /vizql/get_export?:export_format=%2&:wb=$3&:vw=$4&:site=$2 [B,NE,QSA]

RewriteRule ^/(t/([^/]*)/)?views/([^/]+)/(.*)\.(png|pdf|csv) /vizql/get_export?:export_format=$5&:wb=$3&:vw=$4&:site=$2 [PT,B,NE,QSA]

RewriteCond %{QUERY_STRING} "(.*(?::|%3A)embed=(y|yes|t|true|1).*)" [NC]
RewriteRule ^/(t/([^/]*)/)?views/([^/]+)/(.*) /vizql/show?:site=$2&:wb=$3&:vw=$4&%1 [PT,NE]

RewriteRule ^/(t/([^/]*)/)?offline_views/([^/]+)/(.*) /vizql/show_offline_view?:site=$2&:wb=$3&:vw=$4&%1 [PT,NE,QSA]

RewriteCond %{QUERY_STRING} (.*)
RewriteRule ^/(t/([^/]*)/)?shared/(.*) /vizql/shared?:site=$2&:guid=$3&%1 [PT,NE]

RewriteRule ^/(t/([^/]*)/)?workbooks/([^/]+)(/([^/]+))/history/([0-9]*) /vizql/showRevision?:site=$2&:wb=$3&:rev=$6&:vw=$5&%{QUERY_STRING} [B,PT,NE]

RewriteRule ^/(t/([^/]*)/)?workbooks/([^/]+)/history/([0-9]*) /vizql/showRevision?:site=$2&:wb=$3&:rev=$4&%{QUERY_STRING} [B,PT,NE]
RewriteCond %{QUERY_STRING} (.*)
RewriteRule ^/trusted/?$ /vizql/trusted/ [PT,NE]

RewriteCond %{QUERY_STRING} (.*)
RewriteRule ^/trusted/(.*) /vizql/trusted/$1 [PT,NE]

RewriteCond %{QUERY_STRING} ^(.*[^:])(:?format=(png|pdf|csv)&?)(.*)$
RewriteRule ^/vizql/get_export(.*) /vizql/get_export?%1%4 [PT,NE]

SetEnvIf Request_URI "vizql/tilecache/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)/(.*)" __vizql_session_id=$1.$2:$4
SetEnvIf Request_URI "/vizql(/t/[^/]+)?(/w/[^/]+/v/[^/]+)?/([^/]+/)?sessions/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)" __vizql_session_id=$4.$5:$7

SetEnvIf Request_URI "/vizql/([^/]+/)?sessions/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)" __vizql_session_id=$2.$3:$5
    RequestHeader set Cookie "expr=__vizql_session_id=%{reqenv:__vizql_session_id}; %{HTTP_COOKIE}" env=__vizql_session_id

AliasMatch /vizql/tilecache/([0-9a-fA-F]+-0)(:|\%3[A|a])([0-9]+)/(.*) "/var/opt/tableau/tableau_server/data/tabsvc/vizqlserver/tilecache/$4"
ProxyPassMatch /vizql/tilecache/([0-9a-fA-F]+-0)(:|\%3[A|a])([0-9]+) !

ProxyPassMatch ^/vizql(/v_[^/]+)?/(cursors|css|html|images|javascripts|stylesheets|fonts|extensions)(/.*)$ !
ProxyPassMatch ^/vizql(/v_[^/]+)?/static_assets\.zip$ !
ProxyPassMatch ^/sessions/([0-9a-fA-F]+-[0-9]+)(:|\%3[A|a])([0-9]+)/instance/images(/.*)$ !
ProxyPass /vizql/tilecache !

#pps#
ProxyPass        /vizql balancer://vizqlserver-cluster/vizql stickysession=__vizql_session_id nofailover=On lbmethod=bybusyness
ProxyPassReverse /vizql balancer://vizqlserver-cluster/vizql

RewriteRule ^/(t/[^/]*/)?dataserver(/t/[^/]+)?(/d/[^/]+)?/(.*) /dataserver/$4 [PT,NE]

SetEnvIf Request_URI "/dataserver(/t/[^/]+)?(/d/[^/]+)?/[0-9a-fA-F]+-([0-9]+)(:|\%3[A|a])([0-9]+)/" __dataserver_routing_id=$3:$5
    RequestHeader set Cookie "expr=__dataserver_routing_id=.%{reqenv:__dataserver_routing_id}; %{HTTP_COOKIE}" env=__dataserver_routing_id

SetEnvIf Request_URI "/dataserver/create.xml" __dataserver_is_create_request
RequestHeader unset X-suggested-session-id env=!__dataserver_is_create_request

#pps#
ProxyPass        /dataserver balancer://dataserver-cluster/dataserver stickysession=__dataserver_routing_id nofailover=On lbmethod=bybusyness
ProxyPassReverse /dataserver balancer://dataserver-cluster/dataserver

    AliasMatch ^/vizql(/v_[^/]+)?/(cursors|css|html|images|javascripts|stylesheets|fonts|extensions)(/.*)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizqlserver/public$1/$2$3"
    AliasMatch ^/vizql(/v_[^/]+)?/(static_assets\.zip)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizqlserver/public$1/$2"
AliasMatch ^/sessions/([0-9a-fA-F]+-[0-9]+)(:|\%3[A|a])([0-9]+)/instance/images(/.*)$ "/var/opt/tableau/tableau_server/data/tabsvc/instance_static_assets/images$4"

Alias /TabcmdInstaller.exe "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/../extras/TabcmdInstaller.exe"
ProxyPassMatch /TabcmdInstaller.exe$ !

ProxyPass /errors !
ProxyPassMatch (^|^/wg)(/v_[^/]+)?/(images|desktop|stylesheets|javascripts)(/.*)$ !


RewriteCond %{REQUEST_URI} !^(/t/[^/]+)?/vizportal/.*
RewriteCond %{QUERY_STRING} (twb_upload_id|tds_upload_id|tde_upload_id|(?i)uploadSessionId)=([0-9]+)(:|\%3[A|a])([0-9a-fA-F]+)-([0-9]+)(:|\%3[A|a])([0-9]+).*$
RewriteRule ^ - [env=__vizportal_upload_route:%5:%7]

RewriteCond %{REQUEST_URI} ^(/t/[^/]+)?/vizportal/.*
RewriteCond %{QUERY_STRING} (twb_upload_id|tds_upload_id|tde_upload_id)=([0-9]+)(:|\%3[A|a])([0-9a-fA-F]+)-([0-9]+)(:|\%3[A|a])([0-9]+).*$
RewriteRule ^ - [env=__vizportal_upload_route:%5:%7]

SetEnvIf Request_URI "/file_uploads/([0-9]+)(:|\%3[A|a])([0-9a-fA-F]+)-([0-9]+)(:|\%3[A|a])([0-9]+)(/)?" __vizportal_upload_route=$4:$6
SetEnvIf Request_URI "(?i)/fileUploads/([0-9]+)(:|\%3[A|a])([0-9a-fA-F]+)-([0-9]+)(:|\%3[A|a])([0-9]+)(/)?" __vizportal_upload_route=$4:$6
SetEnvIf Request_URI "/vizportal/api/clientxml/file_uploads/([0-9]+)(:|\%3[A|a])([0-9a-fA-F]+)-([0-9]+)(:|\%3[A|a])([0-9]+)/" __vizportal_upload_route=$4:$6
    RequestHeader set Cookie "expr=__wgserver_upload_route=.%{reqenv:__wgserver_upload_route}; %{HTTP_COOKIE}" env=__wgserver_upload_route
    RequestHeader set Cookie "expr=__vizportal_upload_route=.%{reqenv:__vizportal_upload_route}; %{HTTP_COOKIE}" env=__vizportal_upload_route


<Directory "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/embeddingapi/public">
    Require all granted
    Header set Access-Control-Allow-Origin "*"
</Directory>
ProxyPassMatch ^/javascripts/api/tableau.embedding.(.*) !
AliasMatch ^/javascripts/api/tableau.embedding.(.*) "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/embeddingapi/public/tableau.embedding.$1"

<Directory "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist">
    Require all granted
    Header set Access-Control-Allow-Origin "*"
    <Files "index.html">
        Header unset X-Frame-Options
    </Files>
</Directory>
ProxyPassMatch ^/javascripts/api/tableau.metric.(.*) !
AliasMatch ^/javascripts/api/tableau.metric.(.*) "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/tableau.metric.$1"

ProxyPassMatch ^/t/([^/]+)/metrics-embed$ !
AliasMatch ^/t/([^/]+)/metrics-embed/$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/index.html"

ProxyPassMatch ^/t/([^/]+)/metrics-embed/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf|\.map)(\.gz)?)$ !
ProxyPassMatch ^/t/([^/]+)/metrics-embed/(compiled-locales/[^/]+)$ !
ProxyPassMatch ^/t/([^/]+)/metrics-embed/(fonts/[^/]+)$ !

AliasMatch ^/t/([^/]+)/metrics-embed/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf)(\.gz)?)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/$2"
AliasMatch ^/t/([^/]+)/metrics-embed/(compiled-locales/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/$2"
AliasMatch ^/t/([^/]+)/metrics-embed/(fonts/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/$2"

ProxyPassMatch ^/metrics-embed$ !
AliasMatch ^/metrics-embed/$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/index.html"

ProxyPassMatch ^/metrics-embed/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf|\.map)(\.gz)?)$ !
ProxyPassMatch ^/metrics-embed/(compiled-locales/[^/]+)$ !
ProxyPassMatch ^/metrics-embed/(fonts/[^/]+)$ !

AliasMatch ^/metrics-embed/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf)(\.gz)?)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/$1"
AliasMatch ^/metrics-embed/(compiled-locales/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/$1"
AliasMatch ^/metrics-embed/(fonts/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/metricsembedding/dist/$1"
ProxyPassMatch ^/([a-z][a-z](_[a-zA-Z]*[_]*[A-Z][A-Z])?/[^/]+\.html(\.gz|\.br)?)$ "!
ProxyPassMatch ^/([^/]+(\.js|\.css|\.map|\.wasm)(\.gz|\.br)?)$ !
ProxyPassMatch ^/((img|loc|locales|.well-known|localize)/[^/]+)$ !
ProxyPassMatch ^/static_assets\.zip$ !

AliasMatch ^/([a-z][a-z](_[a-zA-Z]*[_]*[A-Z][A-Z])?/[^/]+\.html(\.gz|\.br)?)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public/$1"
AliasMatch ^/([^/]+(\.js|\.css|\.map|\.wasm)(\.gz|\.br)?)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public/$1"
AliasMatch ^/((img|loc|locales|.well-known|localize)/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public/$1"
AliasMatch ^/(static_assets\.zip)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public/$1"

<Location "/.well-known/apple-app-site-association">
    ForceType application/json
</Location>

ProxyPassMatch ^/$ !
AliasMatch ^/$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public/index.html"
RewriteCond %{QUERY_STRING} (^|&)debug=(y|yes|t|true|1)(&|$)
RewriteRule ^/$ "/en/vizportalDebug.html"

<FilesMatch "index.html">
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires -1
</FilesMatch>

<Directory "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/vizportalclient/public">
    <FilesMatch "embedded(.*)\.html(\.gz|\.br)?">
        Header unset X-Frame-Options
    </FilesMatch>
</Directory>
<DirectoryMatch ".+/v_[^/]+/extensions">
    <FilesMatch "index.html">
        Header unset X-Frame-Options
    </FilesMatch>
</DirectoryMatch>

RewriteRule ^/signin/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/signin [R,NE,QSA,L]

RewriteRule ^/signedOut/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/signedOut [R,NE,QSA,L]




RewriteRule ^/(t/([^/]*)/)?auth/request_oauth(.*)$ /vizportal/api/rest/v1/auth/request_oauth$3 [PT,NE]
RewriteRule ^/(t/([^/]*)/)?auth/add_oauth_token(.*)$ /vizportal/api/rest/v1/auth/add_oauth_token$3 [PT,NE]
RewriteRule ^/(t/([^/]*)/)?auth/add_generic_auth_credentials(.*)$ /vizportal/api/rest/v1/auth/add_generic_auth_credentials$3 [PT,NE]
RewriteRule ^/(t/([^/]+)/)?vizportal/api/clientxml/workbooks/([^/]+\.twbx?)$   balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/clientxml/workbooks/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?vizportal/api/clientxml/datasources/([^/]+\.tdsx?)$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/clientxml/datasources/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?workbooks/([^/]+\.twbx?)$   balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/workbooks/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?datasources/([^/]+\.tdsx?)$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/datasources/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?flows/([^/]+\.tflx?)$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/flows/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?flows/drafts/([^/]+\.tflx?)$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/flows/drafts/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?flows/([^/]+)/+flowGraphImage\.png$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/flows/graphimage/$3?:site=$2 [P,QSA,NE]
RewriteRule ^(?i)/api/([^/]+)/sites/([^/]+)/workbooks/([^/]+)/content$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/external/$1/sites/$2/workbooks/$3/content [P,QSA,NE]
RewriteRule ^(?i)/api/([^/]+)/sites/([^/]+)/workbooks/([^/]+)/revisions/([^/]+)/content$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/external/$1/sites/$2/workbooks/$3/revisions/$4/content [P,QSA,NE]
RewriteRule ^(?i)/api/([^/]+)/sites/([^/]+)/datasources/([^/]+)/content$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/external/$1/sites/$2/datasources/$3/content [P,QSA,NE]
RewriteRule ^(?i)/api/([^/]+)/sites/([^/]+)/datasources/([^/]+)/revisions/([^/]+)/content$ balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/external/$1/sites/$2/datasources/$3/revisions/$4/content [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?workbooks/history/([^/]+\.twbx?)$   balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/workbooks/history/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?datasources/history/([^/]+\.tdsx?)$   balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/datasources/history/$3?:site=$2 [P,QSA,NE]
RewriteRule ^/(t/([^/]+)/)?flows/history/([^/]+\.tflx?)$   balancer://vizportal-download-cluster/vizportal_prefix_local/vizportal/api/rest/v1/flows/history/$3?:site=$2 [P,QSA,NE]
ProxyPass /vizportal_prefix_local/ balancer://local-vizportal/

# Specific view
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/views/([^/]+)/([^/]+)/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/views/$2/$3 [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/views/([^/]+)/([^/]+)/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/views/$2/$3 [R,NE,L]
# Customized view
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/views/([^/]+)/([^/]+)/([^/]+)/([^/]+)/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/views/$2/$3/$4/$5 [R,BNP,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/views/([^/]+)/([^/]+)/([^/]+)/([^/]+)/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/views/$2/$3/$4/$5 [R,BNP,NE,L]
# Specific project
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteCond %{QUERY_STRING} (?:^|&)project=([^&]*)(?:&|$)
RewriteRule ^()/workbooks/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/projects/%1/workbooks? [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteCond %{QUERY_STRING} (?:^|&)project=([^&]*)(?:&|$)
RewriteRule ^/t/([^/]+)/workbooks/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/projects/%1/workbooks? [R,NE,L]
# Projects list
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/view/projects/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/projects [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/view/projects/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/projects [R,NE,L]
# Admin projects list
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/projects/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/projects [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/projects/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/projects [R,NE,L]
# Workbooks list
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/workbooks/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/workbooks [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/workbooks/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/workbooks [R,NE,L]
# Views list
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/views/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/views [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/views/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/views [R,NE,L]
# Datasources list
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/datasources/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/datasources [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/datasources/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1/datasources [R,NE,L]
# Admin status
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/admin/status/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/server/status [R,NE,L]
# Sites list
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/sites/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/server/sites [R,NE,L]
# Login page
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/auth/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/signin [R,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/auth/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/signin [R,NE,L]

RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/?$ %{ENV:scheme}://%{SERVER_NAME}%{ENV:port_part_from_request}/#/site/$1 [R,B,NE,L]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/workbooks/([^/]+)$ /vizportal/api/rest/v1/redirectToWorkbookPage?:wb=$2&:site= [PT,NE]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/workbooks/([^/]+)$ /vizportal/api/rest/v1/redirectToWorkbookPage?:wb=$2&:site=$1 [PT,NE]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^()/datasources/([^/]+)$ /vizportal/api/rest/v1/redirectToDatasourcePage?:ds=$2&:site= [PT,NE]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/t/([^/]+)/datasources/([^/]+)$ /vizportal/api/rest/v1/redirectToDatasourcePage?:ds=$2&:site=$1 [PT,NE]


RewriteCond %{HTTP_USER_AGENT} "(MSIE ([0-9]+)\.|Presto\/)|Trident/.*rv:([0-9]{1,}[\.0-9]{0,})|(iPad|iPhone|iphone|iPod).*?(OS |os |OS_)([0-8]_)"
RewriteRule ^/$ /vizportalclient/unsupportedBrowser.var [PT,NE]
RewriteCond %{REQUEST_URI}  !\.xml$
RewriteCond %{QUERY_STRING} !(^|&)format=xml(&|$)
RewriteRule ^/(t/([^/]+)/)?vizportal/api/clientxml/datasources/([^/]+)$ /vizportal/api/clientxml/datasources/$3?:site=$2 [PT,NE]

<Directory "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist">
           Require all granted
</Directory>

ProxyPassMatch ^/published-connection-editor$ !
AliasMatch ^/published-connection-editor/$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist/index.html"

ProxyPassMatch ^/published-connection-editor/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf|\.map)(\.gz)?)$ !
ProxyPassMatch ^/published-connection-editor/(compiled-locales/[^/]+)$ !
ProxyPassMatch ^/published-connection-editor/(fonts/[^/]+)$ !
ProxyPassMatch ^/published-connection-editor/(static/js/[^/]+)$ !
ProxyPassMatch ^/published-connection-editor/(static/media/[^/]+)$ !

AliasMatch ^/published-connection-editor/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf)(\.gz)?)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist/$1"
AliasMatch ^/published-connection-editor/(compiled-locales/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist/$1"
AliasMatch ^/published-connection-editor/(fonts/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist/$1"
AliasMatch ^/published-connection-editor/(static/js/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist/$1"
AliasMatch ^/published-connection-editor/(static/media/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/pconneditor/dist/$1"


<Directory "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/webclients/recommendationsPane">
    Require all granted
</Directory>

ProxyPassMatch ^/recommendations/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf)(\.gz)?)$ !
ProxyPassMatch ^/recommendations/(compiled-locales/[^/]+)$ !

AliasMatch ^/recommendations/([^/]+(\.html|\.css|\.svg|\.js|\.png|\.gif|\.otf|\.ttf)(\.gz)?)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/webclients/recommendationsPane/$1"
AliasMatch ^/recommendations/(compiled-locales/[^/]+)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/webclients/recommendationsPane/$1"

RewriteRule ^/(t/[^/]*/)?(vizportal/api/clientxml/.*)$ /$2 [PT,NE]

#ppd#
  ProxyPassMatch ^/admin/systeminfo\.xml$ balancer://vizportal-cluster/vizportal/api/clientxml/admin/systeminfo$1

#ppd#
  ProxyPassMatch ^/(t/[^/]*/)?thumb/views/([^/]+)/([^/]+)$ balancer://vizportal-cluster/vizportal/api/clientxml/thumb/views/$2/$3
  ProxyPassMatch ^/(t/[^/]*/)?thumb/workbooks/([^/]+)$ balancer://vizportal-cluster/vizportal/api/clientxml/thumb/workbooks/$2/

#pps#
ProxyPass /vizportal/api/web/v1/auth/openId balancer://vizportal-cluster/vizportal/api/web/v1/auth/openId lbmethod=bybusyness
ProxyPass /vizportal/api/web/v1/auth/openIdLogin balancer://vizportal-cluster/vizportal/api/web/v1/auth/openIdLogin lbmethod=bybusyness
#ppd#
  ProxyPass /vizportal/api/saml balancer://vizportal-cluster/vizportal/saml lbmethod=bybusyness
  ProxyPassReverse /vizportal/api/saml balancer://vizportal-cluster/vizportal/saml
#ppd#
  ProxyPass /wg/saml balancer://vizportal-cluster/vizportal/saml
#pps#
ProxyPass /public/idp/SSO  balancer://samlservice-cluster/public/idp/SSO
#ppd#
  ProxyPass /public/idp/SLO  balancer://vizportal-cluster/vizportal/saml/logout/index.html
#ppd#
  ProxyPassMatch ^\/samlservice(?!\/+private)\/(.*)$ balancer://samlservice-cluster/$1

<LocationMatch "^/wg/saml|^/vizportal/api/saml">
  ProxyErrorOverride On
</LocationMatch>

#pps#
ProxyPass /vizportal/api balancer://vizportal-cluster/vizportal/api lbmethod=bybusyness stickysession=__vizportal_upload_route nofailover=On

#ppd#
  ProxyPass /oauth2/v1 balancer://vizportal-cluster/vizportal/oauth2/v1
#ppd#
  ProxyPass /oembed/v1 balancer://vizportal-cluster/vizportal/oembed/v1
#ppd#
  ProxyPass /sidecar balancer://vizportal-cluster/vizportal/sidecar

RewriteRule ^(?i)/api$ /api/ [PT,NE]
#ppd#
  ProxyPass /api/ balancer://vizportal-cluster/vizportal/api/external/ lbmethod=byrequests stickysession=__vizportal_upload_route nofailover=On

ProxyPassReverse / balancer://vizportal-cluster/


  AddType text/x-component .htc

RewriteEngine On
RewriteCond %{REQUEST_METHOD} (OPTIONS)
RewriteRule .* - [R=405,L]

#Alias /errors "/var/opt/tableau/tableau_server/data/tabsvc/config/gateway_0.20221.22.0712.0324/httpd"
# static assets may have an optional urlprefix when wgserver is run from tomcat.  e.g. /wg/v_base/javascripts/base_packaged.js
    AliasMatch (^|^/wg)(/v_[^/]+)?/images/custom(/.*)$ "/var/opt/tableau/tableau_server/data/tabsvc/httpd$2/images/custom$3"
    AliasMatch (^|^/wg)(/v_[^/]+)?/(images|desktop|javascripts|stylesheets)(/.*)$ "/var/opt/tableau/tableau_server/data/tabsvc/services/gateway_0.20221.22.0712.0324/wgserver/public$2/$3$4"

RewriteMap workermap "txt:/var/opt/tableau/tableau_server/data/tabsvc/config/gateway_0.20221.22.0712.0324/httpd/rewrite.txt"

RewriteRule ^/admin/healthcheck_dataserver/0/8972 http://${workermap:0}:8972/dataserver/health_check [proxy]
RewriteRule ^/admin/status_dataserver/0/8972 http://${workermap:0}:8972/dataserver/check_status [proxy]
RewriteRule ^/admin/status_vqlweb/0/8899 http://${workermap:0}:8899/vizql/sessions/check_status [proxy]
RewriteRule ^/admin/healthcheck_vqlweb/0/8899 http://${workermap:0}:8899/vizql/sessions/health_check [proxy]
RewriteRule ^/admin/healthcheck_vizportal/0/8967 http://${workermap:0}:8967/vizportal/health_check [proxy]
RewriteRule ^/admin/status_vizportal/0/8967 http://${workermap:0}:8967/vizportal/check_status [proxy]
RewriteRule ^/admin/healthcheck_backgrounder/0/8945 http://${workermap:0}:8945/backgrounder/health_check [proxy]
RewriteRule ^/admin/status_backgrounder/0/8945 http://${workermap:0}:8945/backgrounder/check_status [proxy]
RewriteRule ^/admin/status_webserver/0/8080 http://${workermap:0}:8080/favicon.ico [proxy]

# dynamic status rules
RewriteRule ^/admin/healthcheck_dataserver/1:0 http://localhost:8972/dataserver/health_check [proxy]
RewriteRule ^/admin/status_dataserver/1:0 http://localhost:8972/dataserver/check_status [proxy]
RewriteRule ^/admin/status_vqlweb/1:0 http://localhost:8899/vizql/sessions/check_status [proxy]
RewriteRule ^/admin/healthcheck_vqlweb/1:0 http://localhost:8899/vizql/sessions/health_check [proxy]
RewriteRule ^/admin/healthcheck_vizportal/1:0 http://localhost:8967/vizportal/health_check [proxy]
RewriteRule ^/admin/status_vizportal/1:0 http://localhost:8967/vizportal/check_status [proxy]
RewriteRule ^/admin/healthcheck_backgrounder/1:0 http://localhost:8945/backgrounder/health_check [proxy]
RewriteRule ^/admin/status_backgrounder/1:0 http://localhost:8945/backgrounder/check_status [proxy]
RewriteRule ^/admin/status_webserver/1 http://localhost:8080/favicon.ico [proxy]
RewriteRule ^/admin/healthcheck_flowprocessor/1:0 http://localhost:8887/flow-processor/health_check [proxy]
RewriteRule ^/admin/status_flowprocessor/1:0 http://localhost:8887/flow-processor/check_status [proxy]

RewriteRule ^(/t/[^/]+)?/admin/status_wgapp.* - [F]
RewriteRule ^/admin/(status|healthcheck)_(backgrounder|dataserver|vizportal|vqlweb|webserver|flowprocessor).* - [F]

ProxyIOBufferSize 1048576
ProxyReceiveBufferSize 1048576
ProxyTimeout 7200

<IfModule reqtimeout_module>
   RequestReadTimeout header=10-30,MinRate=500 body=30,MinRate=500
</IfModule>

<Proxy balancer://vizqlserver-cluster>
    BalancerMember http://localhost:8899 route=1:0 retry=300 connectiontimeout=30
</Proxy>
<Proxy balancer://dataserver-cluster>
    BalancerMember http://localhost:8972 route=1:0 retry=300 connectiontimeout=30
</Proxy>
<Proxy balancer://vizportal-cluster>
    BalancerMember http://localhost:8967 route=1:0 retry=300 connectiontimeout=30
</Proxy>
<Proxy balancer://samlservice-cluster>
    BalancerMember http://localhost:8964 route=1 retry=300 connectiontimeout=30
</Proxy>


 # Gateway-specific configurations end
##############################################################################

##############################################################################
# Vizqlserver-specific start
RewriteCond %{REQUEST_FILENAME} "vizql/tilecache/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)/(.*)"
RewriteCond "/var/opt/tableau/tableau_server/data/tabsvc/vizqlserver/tilecache/%5" -f
RewriteRule "/vizql/tilecache/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)/(.*)" "/vizql/tilecache/$5" [PT,NE]
RewriteCond %{QUERY_STRING} !^fn=
RewriteCond %{REQUEST_FILENAME} "vizql/tilecache/([0-9a-fA-F]+-1)(:|\%3[A|a])0/(.*)"
RewriteCond "/var/opt/tableau/tableau_server/data/tabsvc/vizqlserver/tilecache/%3" !-f
RewriteRule "vizql/tilecache/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)/([0-9]+/[0-9a-fA-F]+)?/views\.(.*)\.(.*)\.(.*)\.(.*)\.png" "http://localhost:8899/vizql/tile/sessions/$1-$2:$4/views/$6?r=$7&x=$8&y=$9" [P,QSA]

RewriteCond %{QUERY_STRING} ^fn=
RewriteCond %{REQUEST_FILENAME} "vizql/tilecache/([0-9a-fA-F]+-1)(:|\%3[A|a])0/(.*)"
RewriteCond "/var/opt/tableau/tableau_server/data/tabsvc/vizqlserver/tilecache/%3" !-f
RewriteRule "vizql/tilecache/([^/]+)-([0-9]+)(:|\%3[A|a])([0-9]+)/([0-9]+)?/([0-9a-fA-F]+)?/views\.(.*)\.(.*)([0-9]+)\.(.*)\.(.*)\.png" "http://localhost:8899/vizql/region/sessions/$1-$2:$4/views/$7?r=$8" [P,QSA]


<Directory "/var/opt/tableau/tableau_server/data/tabsvc/vizqlserver/tilecache" >
    Require all granted
    ExpiresActive On 
    ExpiresDefault "modification plus 10 years"
</Directory>

Alias /vizql/tilecache "/var/opt/tableau/tableau_server/data/tabsvc/vizqlserver/tilecache"

 # Vizqlserver-specific end
##############################################################################

RewriteCond %{HTTP:Accept-Encoding}" "br"
RewriteRule "^(.*)(\.js|\.css|\.html|\.map|\.svg|\.wasm)" - [E=GZIP_LOOKAHEAD:%{REQUEST_FILENAME},NE]
RewriteCond %{HTTP:Accept-Encoding}" "br"
RewriteCond %{REQUEST_FILENAME}" ^(.*)(\.js|\.css|\.html|\.map|\.svg|\.wasm)"
RewriteCond "%{LA-U:REQUEST_FILENAME}\.br" -s
RewriteRule "^(.*)" "$1\.br" [QSA]

RewriteRule "\.css\.br$" "-" [T=text/css,E=no-gzip:1]
RewriteRule "\.js\.br$" "-" [T=text/javascript,E=no-gzip:1]
RewriteRule "\.html\.br$" "-" [T=text/html,E=no-gzip:1]
RewriteRule "\.map\.br$" "-" [T=application/json,E=no-gzip:1]
RewriteRule "\.svg\.br$" "-" [T=image/svg+xml,E=no-gzip:1]
RewriteRule "\.wasm\.br$" "-" [T=application/wasm,E=no-gzip:1]


<FilesMatch "(\.css\.br|\.js\.br|\.html\.br|\.map\.br|\.svg\.br|\.wasm\.br)$">
  # Serve correct encoding type.
  Header append Content-Encoding br

  # Force proxies to cache gzipped &
  # non-gzipped css/js files separately.
  Header append Vary Accept-Encoding
</FilesMatch>
RewriteCond %{HTTP:Accept-Encoding}" "gzip"
RewriteRule "^(.*)(\.js|\.css|\.html|\.map|\.svg|\.wasm)" - [E=GZIP_LOOKAHEAD:%{REQUEST_FILENAME},NE]
RewriteCond %{HTTP:Accept-Encoding}" "gzip"
RewriteCond %{REQUEST_FILENAME}" ^(.*)(\.js|\.css|\.html|\.map|\.svg|\.wasm)"
RewriteCond "%{LA-U:REQUEST_FILENAME}\.gz" -s
RewriteRule "^(.*)" "$1\.gz" [QSA]

RewriteRule "\.css\.gz$" "-" [T=text/css,E=no-gzip:1]
RewriteRule "\.js\.gz$" "-" [T=text/javascript,E=no-gzip:1]
RewriteRule "\.html\.gz$" "-" [T=text/html,E=no-gzip:1]
RewriteRule "\.map\.gz$" "-" [T=application/json,E=no-gzip:1]
RewriteRule "\.svg\.gz$" "-" [T=image/svg+xml,E=no-gzip:1]
RewriteRule "\.wasm\.gz$" "-" [T=application/wasm,E=no-gzip:1]

<FilesMatch "(\.css\.gz|\.js\.gz|\.html\.gz|\.map\.gz|\.svg\.gz|\.wasm\.gz)$">
  Header append Content-Encoding gzip
  Header append Vary Accept-Encoding
</FilesMatch>


##############################################################################
# EPS specific configurations
# static server port shows up like vizqlserver_0.eps.static_server.port


RewriteRule ^/vizql/eps/static-server/(.*) balancer://vizqlserver-eps-cluster/$1   [P,QSA]

<Proxy balancer://vizqlserver-eps-cluster>
            BalancerMember http://localhost:8832 retry=300 connectiontimeout=30

    ProxySet stickysession=__vizql_session_id nofailover=On lbmethod=bybusyness
</Proxy>

ProxyPassReverse ^/vizql/eps/static-server/(.*) balancer://vizqlserver-eps-cluster/$1

##############################################################################

RewriteRule ^/vizql/.* - [PT,NE]

RewriteCond %{ENV:DROPPED_MANUAL_PREFIX} =""
RewriteRule .* - [PT,NE,E=!DROPPED_MANUAL_PREFIX]

SecServerSignature "Tableau"

    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "no-referrer-when-downgrade"

Header set Content-Security-Policy-Report-Only "connect-src * https://*.tiles.mapbox.com https://api.mapbox.com; default-src blob:; font-src * data:; frame-src * data:; img-src * data: blob:; object-src data:; report-uri /vizql/csp-report; script-src * blob:; style-src * 'unsafe-inline'"






### relay-target-summary ###
#---#port,host,scheme,group
### relay-target-summary ###
############################
### proxy-target-summary ###
#+#+#port,host,scheme,group
#+#+#8080,localhost,http,vizportal-download-cluster
#+#+#8080,localhost,http,flow-editor-gateway-cluster
#+#+#8803,localhost,http,flow-editor-cluster
#+#+#8803,localhost,http,local-flow-editor
#+#+#8812,localhost,http,local_apigateway
#+#+#8832,localhost,http,vizqlserver-eps-cluster
#+#+#8866,localhost,http,local-collections
#+#+#8885,localhost,http,local-contentexploration
#+#+#8899,localhost,http,vizqlserver-cluster
#+#+#8964,localhost,http,samlservice-cluster
#+#+#8967,localhost,http,local-vizportal
#+#+#8967,localhost,http,vizportal-cluster
#+#+#8972,localhost,http,dataserver-cluster
#+#+#8995,localhost,http,local-dataprofiling
#+#+#8999,localhost,http,datacatalog-cluster
### proxy-target-summary ###
